# üõë –ù–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –¥–≤–æ–π–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É

## –ü—Ä–æ–±–ª–µ–º–∞

Towns –∫—ç—à–∏—Ä—É–µ—Ç UI, –∏ –∫–Ω–æ–ø–∫–∏ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑.

---

## –°–ø–æ—Å–æ–± 1: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤ –ë–î (–¢–µ–∫—É—â–∏–π)

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

```
1. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º confirmation dialog
   ‚Üí –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ pending_transactions (status='pending')

2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç ‚úÖ Confirm
   ‚Üí –ù–∞–ª–µ–≤–∞—é—Ç —Ç—Ä–∞–Ω—Å–∞–∫—Ü–∏–∏ –∏—Å –±–ª–æ–∫—á–µ–π–Ω–∞
   ‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å: 'pending'? ‚úÖ
   ‚Üí –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º
   ‚Üí –ú–µ–Ω—è–µ–º status –Ω–∞ 'processed'

3. –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∫–æ–ª–±–∞—Å—ã
   ‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å: 'processed'? ‚ùå
   ‚Üí –ü—Ä–æ–ø—É—Å–∫–∞–µ–º
```

### –ü–ª—é—Å—ã
- ‚úÖ –î–∞–Ω–Ω—ã–µ —Ä–µ—Å—Ç—Ä–∏—Ü–∏—Ä—É—é—Ç—Å—è –≤ –ë–î
- ‚úÖ –ú–æ–∂–Ω–æ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ç—Ä–∞–Ω—Å–∞–∫—Ü–∏–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö (1+ —á–∞—Å)

### –ú–∏–Ω—É—Å—ã
- ‚ùå –í—ã–º–∞–≥–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–ø–¥–µ–π—Ç–∞ –ë–î –∫–∞–∂–¥—ã–π —á–∞—Å
- ‚ùå –ï—Å–ª–∏ –±–æ—Ç –∫—Ä–∞—à–Ω—É–ª—Å—è - –ø–µ–¥—ç–Ω–¥–∏–Ω–≥ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤ –ë–î

---

## –°–ø–æ—Å–æ–± 2: –û–∫–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ (–í—Ä–µ–º–µ–Ω–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞)

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

```typescript
// –û–¥–Ω–∏ pending_transactions –≤—Å–µ–≥–¥–∞ –¥–∞—é—Ç permission —Ç–æ–ª—å–∫–æ 30 —Å–µ–∫—É–Ω–¥

if (Date.now() - new Date(pendingTx.created_at).getTime() > 30000) {
    // –¢—Ä–∞–Ω–∑–∞ —Å—Ç–∞—Ä–∞—è, —Ä–µ–¥–µ–ø–ª–æ—é–º –∫–Ω–æ–ø–∫–∏
    await deletePendingTransaction(id)
    return
}
```

### –ü–ª—é—Å—ã
- ‚úÖ –ü—Ä–æ—Å—Ç–æ
- ‚úÖ –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–ª–∏–Ω–∞–Ω–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞

### –ú–∏–Ω—É—Å—ã
- ‚ùå –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç—ã–∫–∞–µ—Ç –∫–Ω–æ–ø–∫—É —á–µ—Ä–µ–∑ 40 —Å–µ–∫ - –≤–æ–∑–º–æ–∂–Ω–∞ –¥–≤–æ–π–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
- ‚ùå –ô–¥–∏–æ–ø–∞—Ç–∏—á–Ω–∞—è —Ç–∞–π–º–∞—É—Ç (30—Å —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ)

---

## –°–ø–æ—Å–æ–± 3: –ö—ç—à —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–£—Ä–æ–≤–µ–Ω—å —Å–µ—Ç–∏)

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

```typescript
// Txs —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º —Ö–µ—à–æ–º –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è
const txHash = keccak256({
    to: recipient,
    value: amount,
    timestamp: Math.floor(Date.now() / 1000)
})

if (processedTxs.has(txHash)) {
    return  // –£–∂–µ –±—ã–ª–∞!
}
```

### –ü–ª—é—Å—ã
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ë–î
- ‚úÖ –ë—ã—Å—Ç—Ä–æ (–º–µ–º–æ—Ä–∏)

### –ú–∏–Ω—É—Å—ã
- ‚ùå –ü–æ—Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞
- ‚ùå –ú–µ–º–æ—Ä–∏ –æ—Ç —Å—Ç–∞—Ä—ã—Ö tx –≤ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚ùå –ù–µ —Ç—Ä–∞—Å—Å–∏—Ä—É–µ—Ç—Å—è

---

## –°–ø–æ—Å–æ–± 4: –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å + nonce

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

```typescript
// –í—ã–¥–µ–ª—è–µ–º –Ω–∞ –∫–∞–∂–¥—É—é —Ç—Ä–∞–Ω–∑—É —É–Ω–∏–∫–∞–ª—å–Ω—ã–π nonce
const nonce = `${userId}-${Date.now()}-${Math.random()}`

// –•—Ä–∞–Ω–∏–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ nonce
usedNonces.add(nonce)

// –ü—Ä–∏ —Ä–µ–ø–µ—Ç–∏—Ü–∏–∏ - —Ç–æ—Ç –∂–µ nonce
if (usedNonces.has(nonce)) {
    return  // —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω!
}
```

### –ü–ª—é—Å—ã
- ‚úÖ –ü—Ä–æ—Å—Ç–æ
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —á–∞—Å—Ç–∏—á–Ω–æ —Å —Ü–µ–ª–∏–µ–≤—ã–º–∏ —Ç—Ä–∞–Ω—Å–∞–∫—Ü–∏—è–º–∏

### –ú–∏–Ω—É—Å—ã
- ‚ùå –ü–æ—Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Å—Ç–∞—Ä—Ç–µ
- ‚ùå –û–¥–∏–Ω–æ–∫ —É—Ä–æ–≤–Ω—å –¥–µ—Ç–µ–∫—Ü–∏–∏

---

## –ù–ê–®–û –†–û–í–ï–ù–´–ú –ù–ï –í–û–õ–®–ï–ë–ê–Æ–¢

### –ü–æ—á–µ–º—É –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–∏—Å–∞–±–ª–µ—Ç—å –∫–Ω–æ–ø–∫–∏?

```typescript
// –£—Ö - Towns –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç editMessage
// –ù–∞–≤—Å–µ–≥–¥–∞ - –∫–Ω–æ–ø–∫–∏ —Å —Å—Ç–∞—Ä—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ—Å—Ç–∞—é—Ç—Å—è
```

---

## –†–û–î–ò–ù–ö–ê: –û–¢–ö–ê–ó–ê–¢–¨–°–Ø –û–¢ CONFIRMATION

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ü—Ä–∞–º–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å transaction request, –±–µ–∑ –¥–∏–∞–ª–æ–≥–∞

```typescript
bot.onSlashCommand('donate', async (handler, event) => {
    const { args, userId, channelId, spaceId } = event
    const amount = parseFloat(args[0])
    
    // –ù–û {
    // –ü—Ä–∞–º–æ:
    await handler.sendInteractionRequest(channelId, {
        case: 'transaction',  // –ù–û –¥–∏–∞–ª–æ–≥–∞!
        value: {
            // ...
        }
    })
    // }
})
```

### –ü–ª—é—Å—ã
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç pending_transactions
- ‚úÖ –ù–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞

### –ú–∏–Ω—É—Å—ã
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤ –∫–æ—à–µ–ª—å–∫–µ
- ‚ùå –ù–µ—Ç confirmation dialog
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ —Å–¥–µ–ª–∞—Ç—å –æ—à–∏–±–∫—É

---

## –ú–û–ô –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ô

| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –ö–æ–º–±–∏–Ω–∞—Ü–∏—è | –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å |
|-----------|------------|----------|
| 1Ô∏è‚É£ | –°–ø–æ—Å–æ–± 1 + –°–ø–æ—Å–æ–± 2 | **[–õ–£–ß–®–ï –í–°–ï–ì–û]** –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å + –æ–∫–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ |
| 2Ô∏è‚É£ | –°–ø–æ—Å–æ–± 1 + –°–ø–æ—Å–æ–± 4 | –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å + –Ω—É–Ω—Ü–µ –≤ –¥–∞–Ω–Ω—ã—Ö |
| 3Ô∏è‚É£ | –°–ø–æ—Å–æ–± 5 | –û—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç confirmation (–ü–†–û–°–¢–û!) |
| ‚ùå | –°–ø–æ—Å–æ–± 3 —Ç–æ–ª—å–∫–æ | –û—á–µ–Ω—å –Ω–µ–ø–æ–ª–Ω—ã–π - —Ç–æ–ª—å–∫–æ memory |

---

## üß™ –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

```bash
# 1. –û—Ç–∫—Ä–æ–π —á–∞—Ç
/donate 5

# 2. –ù–∞–∂–º–∏ ‚úÖ Confirm
# –î–æ–ª–∂–Ω–∞ —Å—Ä–∞–±–æ—Ç–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞

# 3. –ë—ã—Å—Ç—Ä–æ –µ—â–µ —Ä–∞–∑ –Ω–∞–∂–º–∏ ‚úÖ Confirm (–Ω–∞ –µ—â–µ –≤–∏–¥–∏–º—É—é –∫–Ω–æ–ø–∫—É)
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–æ –∏–ª–∏ –æ—à–∏–±–∫–∞

# 4. –û–±–Ω–æ–≤–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)
# –ö–Ω–æ–ø–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∏–¥–Ω—ã –∏–∑ –∫—ç—à–∞

# 5. –ù–∞–∂–º–∏ ‚úÖ Confirm
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–æ

# 6. –°–º–æ—Ç—Ä–∏ –ª–æ–≥–∏
sudo journalctl -u tipsobot -f | grep "Transaction Response"
```

---

**–¢–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ:** –°–ø–æ—Å–æ–± 1 (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞)
**–°—Ç–∞—Ç—É—Å:** Development üîß
**–î–∞—Ç–∞:** 2025-12-09
