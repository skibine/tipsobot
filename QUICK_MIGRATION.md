# –ë—ã—Å—Ç—Ä—ã–π —á–µ–∫-–ª–∏—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î üöÄ

–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ~30 –º–∏–Ω—É—Ç

## ‚úÖ –î–û –Ω–∞—á–∞–ª–∞ (–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞)

- [ ] **–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–æ—Ç** (Ctrl+C)
```bash
kill $(pgrep -f "node.*index.ts")
```

- [ ] **–°–¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø**
```bash
pg_dump tipsobot > backup_$(date +%Y%m%d_%H%M%S).sql
echo "–ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω –≤: backup_YYYYMMDD_HHMMSS.sql"
```

- [ ] **–£–∑–Ω–∞–π—Ç–µ space_id –≤–∞—à–µ–≥–æ –≥–æ—Ä–æ–¥–∞**
  - –°–ø—Ä–æ—Å–∏—Ç–µ —É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ Towns Protocol
  - –ò–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ: 0x1234567890abcdef...

- [ ] **–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ migrate.sql**
```bash
nano src/migrate.sql
```
–ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫—É:
```
LET default_space_id = 'DEFAULT_SPACE_ID';
```
–ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à actual space_id:
```
LET default_space_id = '0xyour_space_id';
```
–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ (Ctrl+O, Enter, Ctrl+X)

## ‚úÖ –ú–ò–ì–†–ê–¶–ò–Ø (–û—Å–Ω–æ–≤–Ω–æ–µ)

- [ ] **–û—Ç–∫—Ä–æ–π—Ç–µ PostgreSQL –∫–æ–Ω—Å–æ–ª—å**
```bash
psql -U postgres -d tipsobot
```

- [ ] **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é**
```sql
\i src/migrate.sql
```

- [ ] **–î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è** (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ —É—Å–ø–µ—Ö–µ)

## ‚úÖ –ü–†–û–í–ï–†–ö–ê (–í–∞–ª–∏–¥–∞—Ü–∏—è)

- [ ] **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫**
```sql
SELECT COUNT(*) FROM global_stats_old;
SELECT COUNT(*) FROM global_stats;
```
–ß–∏—Å–ª–∞ –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å!

- [ ] **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ user_stats**
```sql
SELECT COUNT(*) FROM user_stats_old;
SELECT COUNT(*) FROM user_stats;
```
–ß–∏—Å–ª–∞ –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å!

- [ ] **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ space_id –≤–µ–∑–¥–µ –∑–∞–ø–æ–ª–Ω–µ–Ω**
```sql
SELECT COUNT(*) FROM global_stats WHERE space_id IS NULL;
SELECT COUNT(*) FROM user_stats WHERE space_id IS NULL;
SELECT COUNT(*) FROM user_cooldowns WHERE space_id IS NULL;
SELECT COUNT(*) FROM pending_transactions WHERE space_id IS NULL;
```
–í—Å–µ –¥–æ–ª–∂–Ω—ã –≤–µ—Ä–Ω—É—Ç—å 0 (–Ω–µ—Ç NULL)!

- [ ] **–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∫–∞–∫–æ–π space_id –±—ã–ª –Ω–∞–∑–Ω–∞—á–µ–Ω**
```sql
SELECT DISTINCT space_id FROM global_stats;
```
–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∞—à–µ –∑–Ω–∞—á–µ–Ω–∏–µ

## ‚úÖ –§–ò–ù–ê–õ–ò–ó–ê–¶–ò–Ø (–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ)

- [ ] **–í—ã—Ö–æ–¥–∏—Ç–µ –∏–∑ psql**
```sql
\q
```

- [ ] **–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û: –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ —Ç–∞–±–ª–∏—Ü—ã** (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É–≤–µ—Ä–µ–Ω—ã)
```bash
psql -U postgres -d tipsobot
```
```sql
DROP TABLE global_stats_old;
DROP TABLE user_stats_old;
DROP TABLE user_cooldowns_old;
DROP TABLE pending_transactions_old;
\q
```

- [ ] **–û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥**
```bash
git pull origin main
npm install
```

- [ ] **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç**
```bash
npm start
```

## ‚úÖ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï (–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã)

- [ ] **–¢–µ—Å—Ç 1: /stats —Ä–∞–±–æ—Ç–∞–µ—Ç**
  - –ù–∞–ø–∏—à–∏—Ç–µ /stats –≤ —á–∞—Ç–µ
  - –î–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –≥–æ—Ä–æ–¥–∞

- [ ] **–¢–µ—Å—Ç 2: /leaderboard —Ä–∞–±–æ—Ç–∞–µ—Ç**
  - –ù–∞–ø–∏—à–∏—Ç–µ /leaderboard –≤ —á–∞—Ç–µ
  - –î–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ø —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –≥–æ—Ä–æ–¥–∞

- [ ] **–¢–µ—Å—Ç 3: /tip —Ä–∞–±–æ—Ç–∞–µ—Ç**
  - –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –∫–æ–≥–æ-—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —á–∞–µ–≤—ã–µ: /tip @someone 5
  - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–∏–ª–∞—Å—å

- [ ] **–¢–µ—Å—Ç 4: –î–æ–±–∞–≤—å—Ç–µ –≤ –¥—Ä—É–≥–æ–π –≥–æ—Ä–æ–¥**
  - –ï—Å–ª–∏ –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å, –¥–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –µ—â–µ –≤ –æ–¥–∏–Ω –≥–æ—Ä–æ–¥
  - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –ù–ï —Å–º–µ—à–∏–≤–∞—é—Ç—Å—è
  - –í –≥–æ—Ä–æ–¥–µ –ê –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–¥–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  - –í –≥–æ—Ä–æ–¥–µ –ë –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥—Ä—É–≥–∞—è

## üö® –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

### –û—à–∏–±–∫–∞: "DEFAULT_SPACE_ID is not defined"
–í—ã –∑–∞–±—ã–ª–∏ –∑–∞–º–µ–Ω–∏—Ç—å DEFAULT_SPACE_ID –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ migrate.sql –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞

### –û—à–∏–±–∫–∞: "–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É - –æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è"
–ë–æ—Ç –≤—Å–µ –µ—â–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ:
```bash
kill $(pgrep -f "node.*index.ts")
```

### –û—à–∏–±–∫–∞: "–ú–∏–≥—Ä–∞—Ü–∏—è —Å–ª–æ–º–∞–ª–∞ –¥–∞–Ω–Ω—ã–µ"
–ù–ï–ú–ï–î–õ–ï–ù–ù–û –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–∑ –±—ç–∫–∞–ø–∞:
```bash
psql -U postgres -d tipsobot < backup_YYYYMMDD_HHMMSS.sql
```
–ü–µ—Ä–µ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞

## üìû –ï—Å–ª–∏ –Ω–µ —É–≤–µ—Ä–µ–Ω—ã

1. –ù–µ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ DROP TABLE –∫–æ–º–∞–Ω–¥—ã
2. –û—Å—Ç–∞–≤–ª—è–π—Ç–µ —Å—Ç–∞—Ä—ã–µ —Ç–∞–±–ª–∏—Ü—ã (_old —Ç–∞–±–ª–∏—Ü—ã) –∫–∞–∫ –±—ç–∫–∞–ø
3. –°–ø—Ä–æ—Å–∏—Ç–µ —É –∫–æ–ª–ª–µ–≥–∏, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
4. –ò–º–µ–π—Ç–µ –ø—Ä–∏ —Å–µ–±–µ —Ñ–∞–π–ª –±—ç–∫–∞–ø–∞
5. –ù–µ —Ç–æ—Ä–æ–ø–∏—Ç–µ—Å—å - –ª—É—á—à–µ 1 —á–∞—Å –º–µ–¥–ª–µ–Ω–Ω–æ, —á–µ–º –ø–æ—Ç–æ–º —á–∏–Ω–∏—Ç—å

## ‚ú® –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

‚úÖ –°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö _old
‚úÖ –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ —Å space_id
‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å per-town —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
‚úÖ –ë—ç–∫–∞–ø —Å–æ—Ö—Ä–∞–Ω–µ–Ω –Ω–∞ —Å–ª—É—á–∞–π –ø—Ä–æ–±–ª–µ–º
‚úÖ –ì–æ—Ç–æ–≤–æ –¥–æ–±–∞–≤–ª—è—Ç—å –±–æ—Ç–∞ –≤ —Ä–∞–∑–Ω—ã–µ –≥–æ—Ä–æ–¥–∞!

---

–£–¥–∞—á–∏ —Å –º–∏–≥—Ä–∞—Ü–∏–µ–π! üöÄ
